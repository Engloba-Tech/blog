<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Android on Engloba Tech - Blog</title><link>http://example.org/tags/android/</link><description>Recent content in Android on Engloba Tech - Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 30 Dec 2020 08:40:44 +0100</lastBuildDate><atom:link href="http://example.org/tags/android/index.xml" rel="self" type="application/rss+xml"/><item><title>Configurando CD para mi aplicación React Native a Google Play con App Center</title><link>http://example.org/posts/rn-appcenter-googleplay/</link><pubDate>Wed, 30 Dec 2020 08:40:44 +0100</pubDate><guid>http://example.org/posts/rn-appcenter-googleplay/</guid><description>
&lt;h3 id="devops-en-2021">Devops en 2021&lt;/h3>
&lt;p>Últimamente, me atrevo a decir que en los últimos 4 o 5 años, los equipos de desarrollo hemos mejorado mucho en cuanto a automatización de deploys y demás. Ha habido un auge devops que ha hecho que la mayoría de developers de bien entiendan y definan una pipeline y lo más importante ahora entendemos la importancia de la automatización y como esto va vinculado a entregas rápidas y dinámicas que tanto remarca Agile. A día de hoy no podría hacer un despliegue manual de mis aplicaciones web, de echo al empezar un proyecto lo primero es montar el circuito de CD con un hello world y a partir de ahí empezamos a montar features y lo que quieras.&lt;/p>
&lt;p>Las herramientas de CD/CI también han evolucionado mucho y la adopción del cloud por la mayoría de equipos también tiene a ver en esta tendéncia&amp;hellip; En el caso de Engloba Tech a día de hoy usamos Azure Dev Ops para repos y la configuración de pipelines de nuestras aplicaciones web. Para las apps nativas, la parte de build/deploy/distribute la hacemos desde App Center que es el antiguo Hockey App que en su día compró Microsoft y está totalmente especializado en build/deploy/distribute aplicaciones nativas iOS/Android y te da &amp;ldquo;cosas&amp;rdquo; OOB que si te las tuvieses que montar en una pipeline de Azure Dev Ops te costaría mucho más. Tienes una capa gratuita que te da 4 horas de agente al mes&amp;hellip; Nosotros al final hemos necesitado ampliar (es rollo 40€ mes ahora) pero porque tenemos bastante movimiento.&lt;/p>
&lt;h3 id="cd-en-aplicaciones-nativas">CD en aplicaciones nativas&lt;/h3>
&lt;p>Cuando tu producto incorpora una app nativa, sabemos que lo suyo es hacerla pasar por las correspondientes stores para su distribución. En un servidor web, nadie te va a decir que no puedes subir una web porque el contenido no es super bonito, o no está claro, o porque falta una captura en la descripción de producto o un video explainer (sí sí, apple se gusta un montón pidiendo este tipo de mierdas para aprobarte la publicación). El escenario ideal en nuestro caso sería el mismo que tenemos para las aplicaciones web&amp;hellip; un entorno con CD que suele ser nuestro entorno de beta/pruebas que tiene todo lo último&amp;hellip; y luego tenemos el paso a producción que depende de que pulsemos el botón de la release correspondiente. Es nuestro escenario, no quiero decir que sea el universal ni nada por el estilo&amp;hellip; es una política de despliegues que en nuestro caso funciona y otro equipo podría optar por montar una estrategia de ramas y entornos diferente.&lt;/p>
&lt;h3 id="como-planteamos-este-escenario-en-engloba-tech-desde-app-center">Como planteamos este escenario en Engloba Tech desde App Center&lt;/h3>
&lt;p>En App Center lo montamos un poco diferente a como solemos hacerlo en web, tenemos una rama &amp;ldquo;x&amp;rdquo; que es la que se alinea con nuestro entorno pruebas. Esta rama tiene una build que se distribuye a colaboradores (testers, normalmente nosotros y algún usuario clave de negocio), esta rama por tanto si que está automatizada pero la distrución es mediante App Center y correos&amp;hellip; no pasamos por la store lo cual no es una app válida para el usuario en el sentido que tiene que habilitarse movidas en android para poder usar la app (en ios peor, tienes que vincular el device ID al provisioning profile de la app, un follón añadir un tester)&amp;hellip; la distribución anterior nos sirve para testear la evolución y una vez ok pasamos a la store.&lt;/p>
&lt;p>Te preguntarás como gestionamos la transformación de settings entre un entorno u otro. Lo hacemos jugando con esta secciónd de la build y luego leyendo ese fichero .env desde React Native.&lt;/p>
&lt;p>&lt;img src="http://example.org/img/AppCenter-Build-Env-Variables.PNG" alt="Managing env variables in App Center build" title="Managing env variables in App Center build">&lt;/p>
&lt;p>Y en master tenemos configurada la build que va a las stores donde metemos los valores de producción en los settings de entorno. De este modo al hacer una PR y aprobarla de rama &amp;ldquo;x&amp;rdquo; a master hará que se lance el proceso de publicación a las correspondientes stores.&lt;/p>
&lt;h3 id="evitando-pasos-manuales">Evitando pasos manuales&lt;/h3>
&lt;p>¿Es posible automatizar la subida a la store desde App Center?, La respuesta es sí&amp;hellip; pero eso no quiero decir que tu aplicación esté disponible desde el momento que acaba la release a la store&amp;hellip; tanto Google como Apple tendrán que validar la publicación y puede tardar unos días o incluso que te la deniegen por algún motivo. Esto es un poco jodienda la verdad, porque si el producto web/api/dominio evoluciona a un ritmo tienes que ir con cuidado que no se rompa la app que consume estas apis&amp;hellip; Es posible que te toque cambiar ese V1 que la mayoría solemos meter en nuestras apis por defecto pero que a la hora de la verdad pocas veces te toca mantener versionado en serio en tus apis&amp;hellip; Imagina que por lo que sea la versión iOS está costando 1 mes que entre en la store y no puedes esperar más para disponer de una feature en Android..&lt;/p>
&lt;p>Veamos como automatizar esto desde App Center, en realidad es muy sencillo si ya te mueves bien por App Center y las correspondientes stores. La primera subida no queda otra que hacerla a mano, ánimo jaja.&lt;/p>
&lt;p>Una vez ya tienes la primera subida detallo los pasos necesarios para automatizar la publicación a las stores.&lt;/p>
&lt;h3 id="google-play">Google Play&lt;/h3>
&lt;p>Necesitas una developer account, una vez dentro has de crear una cuenta de servicio que pueda acceder a la api. Lo haremos siguiendo los pasos que ves en las capturas.&lt;/p>
&lt;p>&lt;img src="http://example.org/img/GooglePlay-Api-Access.PNG" alt="Create service account in Google Play Api" title="Create service account in Google Play Api">&lt;/p>
&lt;p>Una vez pulsas en Crear Cuenta de Servicio te dirige a la página de Google Cloud Platform donde puedes crear cuentas de servicio y vincular &amp;ldquo;keys&amp;rdquo; (p12 o json).&lt;/p>
&lt;p>&lt;img src="http://example.org/img/Create-Service-Account-Json-Key.PNG" alt="Creating Api Key and Downloading Json" title="Creating Api Key and Downloading Json">&lt;/p>
&lt;p>Descargamos la clave y nos vamos a App Center, vamos a distribute y configuramos el acceso a Google Play subiendo la clave que hemos descargado.&lt;/p>
&lt;p>&lt;img src="http://example.org/img/Create-Service-Account-Json-Key.PNG" alt="Creating Api Key and Downloading Json" title="Creating Api Key and Downloading Json">&lt;/p>
&lt;p>Una vez tenemos la store vinculada ya podemos seleccionarla en nuestra build Android/Master.&lt;/p>
&lt;p>&lt;img src="http://example.org/img/Distribute-Store-AppCenter.PNG" alt="Select Distribute To Store in Distribution Section" title="Select Distribute To Store in Distribution Section">&lt;/p>
&lt;p>Con esto ya tendríamos automatizada la publicación para Google Play de modo que un commit en master de la app lanza el proceso.&lt;/p>
&lt;h3 id="apple-store">Apple Store&lt;/h3>
&lt;p>Para Apple pues vas a App Center a la app de iOS y en Distribute vamos a Store (igual que para Android).&lt;/p>
&lt;p>Te pedirá tus credenciales del Apple ID con el que tienes cuenta en Apple developer y has registrado la app la primera vez&amp;hellip; Introduces credenciales y como mucho si tienes doble factor de autentiación en tu cuenta (imagino que sí) te hará generar claves para uso de apps que ya verás que el mismo asistente en App Center te guía para hacerlo y es fácil.&lt;/p>
&lt;p>Ahora tendrías que hacer exactamente lo mismo que hemos hecho para Android, ir a la build de master y en la sección Distribute seleccionar Store y Production.&lt;/p>
&lt;p>También podrías distribuir una release existente de modo manual. Si te vas a la release una vez has configurado la store, te sale como una opción más de distribución.
&lt;img src="http://example.org/img/Distribute-Apple-Store-AppCenter.PNG" alt="Manually distributing a existing release to Apple Store" title="Manually distributing a existing release to Apple Store">&lt;/p>
&lt;p>Con esto ya tendríamos automatizada la publicación en las tiendas!&lt;/p></description></item></channel></rss>